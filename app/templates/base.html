<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Bloaty McBloatface{% endblock %}</title>

    <!-- Design System CSS -->
    <link rel="stylesheet" href="/static/css/design-tokens.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components/buttons.css">
    <link rel="stylesheet" href="/static/css/components/cards.css">
    <link rel="stylesheet" href="/static/css/components/forms.css">
    <link rel="stylesheet" href="/static/css/components/navigation.css">
    <link rel="stylesheet" href="/static/css/components/badges.css">
    <link rel="stylesheet" href="/static/css/components/images.css">
    <link rel="stylesheet" href="/static/css/components/disclaimers.css">
    <link rel="stylesheet" href="/static/css/components/icons.css">

    <!-- htmx -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/json-enc.js"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Tippy.js for tooltips -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css" />

    <!-- Custom CSS (for page-specific overrides) -->
    <link rel="stylesheet" href="/static/css/custom.css">

    <style>
        /* Alpine.js cloak */
        [x-cloak] {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="main-nav" x-data="{ mobileMenuOpen: false }">
        <a href="/" class="nav-logo">Bloaty McBloatface</a>

        <!-- Desktop Nav Links -->
        <ul class="nav-links nav-links-desktop">
            {% if user %}
            <li>
                <a href="/meals/history?search=1" class="nav-link nav-search-link" title="Search meals">
                    <svg width="16" height="16" viewBox="0 0 24 24" class="icon" aria-hidden="true" style="overflow: visible;">
                        <use href="/static/icons/lucide-sprite.svg#search"></use>
                    </svg>
                </a>
            </li>
            <li><a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}">Home</a></li>
            <li><a href="/meals/history" class="nav-link {% if request.path.startswith('/meals') %}active{% endif %}">Meal History</a></li>
            <li><a href="/symptoms/history" class="nav-link {% if request.path.startswith('/symptoms') %}active{% endif %}">Symptom History</a></li>
            <li><a href="/diagnosis" class="nav-link {% if request.path.startswith('/diagnosis') %}active{% endif %}">Diagnosis</a></li>
            <li><a href="/auth/account" class="nav-link {% if request.path.startswith('/auth/account') %}active{% endif %}">Account</a></li>
            {% else %}
            <li><a href="/auth/login" class="nav-link {% if request.path == '/auth/login' %}active{% endif %}">Login</a></li>
            {% endif %}
        </ul>

        <!-- Mobile Hamburger Button -->
        <button type="button" class="nav-menu-toggle" @click="mobileMenuOpen = !mobileMenuOpen" aria-label="Toggle menu">
            <svg width="24" height="24" viewBox="0 0 24 24" class="icon" aria-hidden="true" style="overflow: visible;" x-show="!mobileMenuOpen">
                <use href="/static/icons/lucide-sprite.svg#menu"></use>
            </svg>
            <svg width="24" height="24" viewBox="0 0 24 24" class="icon" aria-hidden="true" style="overflow: visible;" x-show="mobileMenuOpen" x-cloak>
                <use href="/static/icons/lucide-sprite.svg#x"></use>
            </svg>
        </button>

        <!-- Mobile Dropdown Menu -->
        <ul class="nav-links nav-mobile-dropdown" x-show="mobileMenuOpen" x-cloak @click.away="mobileMenuOpen = false">
            {% if user %}
            <li>
                <a href="/meals/history?search=1" class="nav-link" @click="mobileMenuOpen = false">
                    <svg width="16" height="16" viewBox="0 0 24 24" class="icon" aria-hidden="true" style="overflow: visible; margin-right: var(--space-2);">
                        <use href="/static/icons/lucide-sprite.svg#search"></use>
                    </svg>
                    Search Meals
                </a>
            </li>
            <li><a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}" @click="mobileMenuOpen = false">Home</a></li>
            <li><a href="/meals/history" class="nav-link {% if request.path.startswith('/meals') %}active{% endif %}" @click="mobileMenuOpen = false">Meal History</a></li>
            <li><a href="/symptoms/history" class="nav-link {% if request.path.startswith('/symptoms') %}active{% endif %}" @click="mobileMenuOpen = false">Symptom History</a></li>
            <li><a href="/diagnosis" class="nav-link {% if request.path.startswith('/diagnosis') %}active{% endif %}" @click="mobileMenuOpen = false">Diagnosis</a></li>
            <li><a href="/auth/account" class="nav-link {% if request.path.startswith('/auth/account') %}active{% endif %}" @click="mobileMenuOpen = false">Account</a></li>
            {% else %}
            <li><a href="/auth/login" class="nav-link {% if request.path == '/auth/login' %}active{% endif %}" @click="mobileMenuOpen = false">Login</a></li>
            {% endif %}
        </ul>
    </nav>

    <!-- Main content -->
    <main class="container">
        {% block content %}{% endblock %}
    </main>

    <!-- Medical Disclaimer Footer (on every page) -->
    <footer class="container" style="margin-top: 4rem; margin-bottom: 2rem;">
        <div class="disclaimer disclaimer-footer" id="medical-disclaimer">
            <svg class="disclaimer-icon icon icon-sm" aria-hidden="true">
                <use href="/static/icons/lucide-sprite.svg#alert-triangle"></use>
            </svg>
            <div class="disclaimer-content">
                <div class="disclaimer-title">Medical Disclaimer</div>
                <div class="disclaimer-text">
                    <p>
                        This application is for personal tracking and informational purposes only. It does not provide medical advice, diagnosis, or treatment. Correlations shown are statistical patterns in your data and may contain errors. Correlation does not prove causation. Always consult a qualified healthcare professional before making dietary changes or health decisions.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    {% block scripts %}{% endblock %}
</body>
</html>
