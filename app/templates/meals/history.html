{% extends "base.html" %}

{% block title %}Meal History - Bloaty McBloatface{% endblock %}

{% block content %}
<div class="history-page" style="margin-bottom: var(--space-6);"
     x-data="{ searchQuery: '{{ search_query|default('', true)|e }}' }">
    <!-- Header (hidden on mobile when search is focused via CSS) -->
    <div class="history-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-6);">
        <div>
            <h1 style="margin-bottom: var(--space-2);">Meal History</h1>
            <p class="text-muted" style="margin: 0;">View and manage your logged meals</p>
        </div>
        <a href="/meals/log" class="btn-primary">
            <svg class="icon icon-sm" aria-hidden="true">
                <use href="/static/icons/lucide-sprite.svg#plus"></use>
            </svg>
            Log New Meal
        </a>
    </div>

    <!-- Search Bar (transforms to full-width on mobile when focused) -->
    <div class="search-bar-container" style="margin-bottom: var(--space-6);">
        <div class="search-bar-inner">
            <input
                type="text"
                name="q"
                placeholder="Search meals..."
                class="form-input search-input"
                hx-get="/meals/history/results"
                hx-trigger="input changed delay:300ms, search"
                hx-target="#meal-results"
                x-ref="searchInput"
                x-model="searchQuery"
                {% if search_active %}autofocus{% endif %}
            >
            <button type="button"
                    class="search-clear-btn"
                    x-show="searchQuery"
                    x-cloak
                    @click="searchQuery = ''; $nextTick(() => $refs.searchInput.dispatchEvent(new Event('input')))">
                <svg width="16" height="16" viewBox="0 0 24 24" class="icon" aria-hidden="true" style="overflow: visible;">
                    <use href="/static/icons/lucide-sprite.svg#x"></use>
                </svg>
            </button>
        </div>
    </div>

    <!-- Meal Results Container -->
    <div id="meal-results">
        {% if search_results is not none %}
            {% set meals = search_results %}
            {% set query = search_query %}
            {% include "meals/partials/meal_cards.html" %}
        {% else %}
            {% include "meals/partials/meal_results_grouped.html" %}
        {% endif %}
    </div>

    <!-- Back Button -->
    <div style="margin-top: var(--space-8); text-align: center;">
        <a href="/" class="btn-ghost">
            <svg class="icon icon-sm" aria-hidden="true">
                <use href="/static/icons/lucide-sprite.svg#arrow-left"></use>
            </svg>
            Back to Home
        </a>
    </div>
</div>
{% endblock %}
