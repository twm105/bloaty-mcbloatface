{% extends "base.html" %}

{% block title %}Edit Symptom - Bloaty McBloatface{% endblock %}

{% block content %}
<article>
    <header>
        <h1>Edit Symptom</h1>
        <p>Update symptom details.</p>
    </header>

    <section>
        <form
            action="/symptoms/{{ symptom.id }}/update"
            method="post"
            x-data="{
                severity: {{ symptom.severity }},
                showNotes: {{ 'true' if symptom.notes else 'false' }}
            }"
        >
            <!-- Timestamp -->
            <div>
                <label for="symptom_timestamp">
                    When did you experience this? *
                </label>
                <input
                    type="datetime-local"
                    id="symptom_timestamp"
                    name="symptom_timestamp"
                    value="{{ symptom.timestamp.strftime('%Y-%m-%dT%H:%M') }}"
                    required
                >
            </div>

            <!-- Description -->
            <div>
                <label for="description">
                    How are you feeling? *
                    <small>Describe your symptoms in your own words</small>
                </label>
                <textarea
                    id="description"
                    name="description"
                    rows="4"
                    required
                >{{ symptom.raw_description }}</textarea>
            </div>

            <!-- Symptom Type -->
            <div>
                <label for="symptom_type">
                    Primary Symptom Type *
                </label>
                <select id="symptom_type" name="symptom_type" required>
                    <option value="">-- Select symptom type --</option>
                    {% for symptom_type in symptom_types %}
                        <option value="{{ symptom_type }}" {% if symptom_type == symptom.structured_type %}selected{% endif %}>
                            {{ symptom_type }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Severity Slider -->
            <div>
                <label for="severity">
                    Severity * (1 = mild, 10 = severe)
                </label>
                <input
                    type="range"
                    id="severity"
                    name="severity"
                    min="1"
                    max="10"
                    x-model="severity"
                    required
                >
                <div class="severity-display" x-text="severity + ' / 10'"></div>
            </div>

            <!-- Optional Notes Toggle -->
            <div>
                <label>
                    <input type="checkbox" x-model="showNotes">
                    Add additional notes
                </label>
            </div>

            <!-- Additional Notes -->
            <div x-show="showNotes" x-cloak>
                <label for="notes">
                    Additional Notes (Optional)
                    <small>Context, triggers, medication taken, etc.</small>
                </label>
                <textarea
                    id="notes"
                    name="notes"
                    rows="3"
                >{{ symptom.notes or '' }}</textarea>
            </div>

            <!-- Submit -->
            <div style="margin-top: 2rem;">
                <button type="submit">Update Symptom</button>
                <a href="/symptoms/history" role="button" class="secondary">Cancel</a>
            </div>
        </form>
    </section>
</article>
{% endblock %}
