{% extends "base.html" %}

{% block title %}Symptom History - Bloaty McBloatface{% endblock %}

{% block content %}
<article>
    <header>
        <h1>Symptom History</h1>
        <p>View and manage your logged symptoms.</p>
    </header>

    {% if success %}
    <section>
        <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 1rem; border-radius: 4px; color: #155724;">
            âœ“ Symptom logged successfully!
        </div>
    </section>
    {% endif %}

    <section>
        <a href="/symptoms/log" role="button">+ Log New Symptom</a>
    </section>

    <!-- Symptoms List -->
    <section>
        {% if symptoms %}
            {% for symptom in symptoms %}
            <article class="symptom-card">
                <header>
                    <div class="grid">
                        <div>
                            <h3 style="margin: 0;">
                                {{ symptom.structured_type or "Symptom" }}
                                <small style="font-weight: normal;">
                                    - Severity {{ symptom.severity }}/10
                                </small>
                            </h3>
                            <p style="margin: 0.3rem 0 0 0;">
                                <small style="color: var(--muted-color);">
                                    {{ symptom.timestamp.strftime('%B %d, %Y at %I:%M %p') }}
                                </small>
                            </p>
                        </div>
                        <div style="text-align: right;">
                            <!-- Severity Badge -->
                            <span style="
                                display: inline-block;
                                padding: 0.3rem 0.6rem;
                                border-radius: 4px;
                                font-weight: bold;
                                font-size: 0.9rem;
                                {% if symptom.severity >= 8 %}
                                    background: #f8d7da; color: #721c24;
                                {% elif symptom.severity >= 5 %}
                                    background: #fff3cd; color: #856404;
                                {% else %}
                                    background: #d4edda; color: #155724;
                                {% endif %}
                            ">
                                {{ symptom.severity }}/10
                            </span>
                        </div>
                    </div>
                </header>

                <!-- Description -->
                <section>
                    <p><strong>Description:</strong></p>
                    <p style="margin-left: 1rem; font-style: italic;">
                        "{{ symptom.raw_description }}"
                    </p>

                    {% if symptom.notes %}
                    <p><strong>Notes:</strong></p>
                    <p style="margin-left: 1rem;">
                        {{ symptom.notes }}
                    </p>
                    {% endif %}

                    {% if symptom.clarification_history and symptom.clarification_history|length > 0 %}
                    <details style="margin-top: 1rem;">
                        <summary>AI Clarification History</summary>
                        <div style="margin-left: 1rem; margin-top: 0.5rem;">
                            {% for qa in symptom.clarification_history %}
                            <div style="margin-bottom: 0.5rem;">
                                <p style="margin: 0;"><strong>Q:</strong> {{ qa.question }}</p>
                                <p style="margin: 0; margin-left: 1rem;">
                                    <strong>A:</strong>
                                    {% if qa.skipped %}
                                        <em>(skipped)</em>
                                    {% else %}
                                        {{ qa.answer }}
                                    {% endif %}
                                </p>
                            </div>
                            {% endfor %}
                        </div>
                    </details>
                    {% endif %}
                </section>

                <!-- Actions -->
                <footer>
                    <a href="/symptoms/{{ symptom.id }}/edit" role="button" class="secondary" style="padding: 0.3rem 0.6rem; font-size: 0.85rem;">
                        Edit
                    </a>
                    <button
                        hx-delete="/symptoms/{{ symptom.id }}"
                        hx-confirm="Are you sure you want to delete this symptom?"
                        hx-target="closest .symptom-card"
                        hx-swap="outerHTML"
                        class="secondary"
                        style="padding: 0.3rem 0.6rem; font-size: 0.85rem;"
                    >
                        Delete
                    </button>
                </footer>
            </article>
            {% endfor %}
        {% else %}
            <article>
                <p><em>No symptoms logged yet.</em></p>
                <a href="/symptoms/log" role="button">Log your first symptom</a>
            </article>
        {% endif %}
    </section>

    <section>
        <a href="/" role="button" class="secondary">Back to Home</a>
    </section>
</article>
{% endblock %}
